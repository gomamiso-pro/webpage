<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Webシステム設計・見積支援ツール v2</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background: #f5f7fa;
    }
    h1 { text-align: center; color: #333; }
    h2 { border-bottom: 2px solid #ccc; margin-top: 30px; padding-bottom: 5px; }
    section {
      background: #fff; padding: 20px; border-radius: 10px;
      margin-top: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    label { display: block; margin-top: 10px; font-weight: bold; }
    select, textarea {
      width: 100%; margin-top: 5px; margin-bottom: 10px;
      padding: 8px; border-radius: 6px; border: 1px solid #ccc;
    }
    button {
      background: #0078d4; color: white; border: none;
      padding: 10px 20px; border-radius: 6px; cursor: pointer;
      font-size: 15px;
    }
    button:hover { background: #005fa3; }
    .result { background: #fff; padding: 20px; border-radius: 10px; margin-top: 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f0f0f0; }
    .price { text-align: right; }
  </style>
</head>
<body>
  <h1>🌐 Webシステム設計・見積支援ツール v2</h1>

  <section>
    <h2>1️⃣ ヒアリングシート（選択式）</h2>

    <label>システム種別</label>
    <select id="systemType">
      <option value="ECサイト" data-price="200000">ECサイト（¥200,000）</option>
      <option value="予約システム" data-price="250000">予約システム（¥250,000）</option>
      <option value="社内管理ツール" data-price="180000">社内管理ツール（¥180,000）</option>
      <option value="ポータルサイト" data-price="220000">ポータルサイト（¥220,000）</option>
    </select>

    <label>主な機能</label>
    <select id="featureSet" multiple size="5">
      <option value="ログイン認証" data-price="30000">ログイン認証（¥30,000）</option>
      <option value="ユーザー管理" data-price="40000">ユーザー管理（¥40,000）</option>
      <option value="検索・一覧表示" data-price="35000">検索・一覧表示（¥35,000）</option>
      <option value="登録・編集" data-price="40000">登録・編集（¥40,000）</option>
      <option value="レポート出力" data-price="50000">レポート出力（¥50,000）</option>
      <option value="通知・メール送信" data-price="30000">通知・メール送信（¥30,000）</option>
      <option value="ダッシュボード" data-price="45000">ダッシュボード（¥45,000）</option>
    </select>

    <label>ユーザー規模</label>
    <select id="scale">
      <option value="small" data-multiplier="1.0">少人数（〜100名）</option>
      <option value="medium" data-multiplier="1.3">中規模（〜1,000名）</option>
      <option value="large" data-multiplier="1.6">大規模（1,000名以上）</option>
    </select>

    <label>特記事項</label>
    <textarea id="notes" rows="3" placeholder="要望、制約、外部連携など"></textarea>

    <button onclick="generateAll()">設計書・見積を生成</button>
  </section>

  <section class="result" id="output"></section>

  <script>
    function generateAll() {
      const systemSelect = document.getElementById("systemType");
      const systemType = systemSelect.value;
      const basePrice = parseInt(systemSelect.selectedOptions[0].dataset.price);

      const selectedFeatures = Array.from(document.getElementById("featureSet").selectedOptions)
        .map(opt => ({ name: opt.value, price: parseInt(opt.dataset.price) }));

      const scaleSelect = document.getElementById("scale");
      const scaleText = scaleSelect.options[scaleSelect.selectedIndex].text;
      const multiplier = parseFloat(scaleSelect.selectedOptions[0].dataset.multiplier);

      const notes = document.getElementById("notes").value;

      // 金額計算
      let subtotal = basePrice;
      selectedFeatures.forEach(f => subtotal += f.price);
      const total = Math.round(subtotal * multiplier);

      // 明細作成
      let estimateTable = `
        <h3>💰 見積明細</h3>
        <table>
          <tr><th>項目</th><th class="price">金額（円）</th></tr>
          <tr><td>${systemType} 基本構築費</td><td class="price">${basePrice.toLocaleString()}</td></tr>
          ${selectedFeatures.map(f => `<tr><td>${f.name}</td><td class="price">${f.price.toLocaleString()}</td></tr>`).join("")}
          <tr><td>ユーザー規模調整 (${scaleText})</td><td class="price">× ${multiplier}</td></tr>
          <tr><th>概算見積金額</th><th class="price">${total.toLocaleString()}</th></tr>
        </table>
      `;

      // 機能一覧
      let featureList = `
        <h3>🧩 機能一覧</h3>
        <table>
          <tr><th>No</th><th>機能名</th><th>概要</th></tr>
          ${selectedFeatures.map((f, i) => `<tr><td>${i+1}</td><td>${f.name}</td><td>${f.name}に関する処理を提供</td></tr>`).join("")}
        </table>
      `;

      // テーブル設計（機能から命名）
      let tableDesign = `
        <h3>🗂️ テーブル設計（自動推定）</h3>
        <table>
          <tr><th>No</th><th>テーブル名</th><th>用途</th></tr>
          ${selectedFeatures.map((f, i) => {
            const tableName = f.name.replace(/[^\w\u3000-\u9fff]/g, "").replace(/\s/g, "_").toLowerCase() + "_tbl";
            return `<tr><td>${i+1}</td><td>${tableName}</td><td>${f.name}関連情報を管理</td></tr>`;
          }).join("")}
        </table>
      `;

      // システム概要
      let systemSummary = `
        <h3>📘 システム概要</h3>
        <p>本システムは<strong>${systemType}</strong>として構築予定。想定規模は<strong>${scaleText}</strong>。</p>
        <p>主要機能は以下の通り。</p>
        <ul>${selectedFeatures.map(f => `<li>${f.name}</li>`).join("")}</ul>
      `;

      const memo = notes ? `<h3>📝 備考</h3><p>${notes}</p>` : "";

      document.getElementById("output").innerHTML =
        systemSummary + featureList + tableDesign + estimateTable + memo;
    }
  </script>
</body>
</html>
