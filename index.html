<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Webè¨­è¨ˆãƒ»è¦‹ç©ãƒ»æŒ‡ç¤ºæ›¸ãƒ„ãƒ¼ãƒ«ï¼ˆAdvancedï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: "Hiragino Sans", sans-serif; margin: 0; padding: 10px; background: #f7f7f7; }
    h1 { text-align: center; font-size: 1.4rem; color: #333; }
    section { background: #fff; padding: 15px; border-radius: 12px; margin-top: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9rem; }
    select, input, textarea {
      width: 100%; padding: 8px; margin-top: 4px;
      border-radius: 6px; border: 1px solid #ccc; font-size: 0.9rem;
    }
    button {
      width: 100%; background: #0078d4; color: white; border: none;
      padding: 12px; border-radius: 8px; margin-top: 15px; font-size: 1rem;
    }
    button:hover { background: #005fa3; }
    .result { background: #fff; padding: 15px; border-radius: 10px; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 6px; }
    th { background: #efefef; }
    .price { text-align: right; }
    textarea#instruction { width: 100%; height: 120px; margin-top: 10px; font-size: 0.9rem; }
    iframe { width: 100%; height: 200px; border: 1px solid #ccc; border-radius: 6px; margin-top: 10px; }
    .sns-icons img { width: 24px; height: 24px; margin-right: 6px; vertical-align: middle; }
  </style>
</head>
<body>
  <h1>ğŸ“± Webè¨­è¨ˆãƒ»è¦‹ç©ãƒ»æŒ‡ç¤ºæ›¸ãƒ„ãƒ¼ãƒ«</h1>

  <section>
    <h2>ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‚·ãƒ¼ãƒˆ</h2>

    <label>ç›®çš„</label>
    <input type="text" id="purpose" placeholder="ä¾‹ï¼šæ–°è¦é¡§å®¢ç²å¾—ãƒ»äºˆç´„åŠ¹ç‡åŒ–ãƒ»æƒ…å ±ç™ºä¿¡ãªã©ï¼ˆæœªå…¥åŠ›ã§ãŠã¾ã‹ã›ï¼‰">

    <label>ã‚·ã‚¹ãƒ†ãƒ ç¨®åˆ¥</label>
    <select id="systemType">
      <option value="ECã‚µã‚¤ãƒˆ">ECã‚µã‚¤ãƒˆ</option>
      <option value="äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ">äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </option>
      <option value="ç¤¾å†…ç®¡ç†">ç¤¾å†…ç®¡ç†</option>
      <option value="ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ">ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ</option>
    </select>

    <label>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤</label>
    <select id="target">
      <option>ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼</option>
      <option>æ³•äºº</option>
      <option>å­¦ç”Ÿãƒ»æ•™è‚²ç³»</option>
      <option>é«˜é½¢è€…å‘ã‘</option>
    </select>

    <label>ä½¿ç”¨è¨€èªï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
    <select id="langs" multiple size="5">
      <option>HTML</option>
      <option>CSS</option>
      <option>JavaScript</option>
      <option>React</option>
      <option>PHP</option>
      <option>Laravel</option>
      <option>Python</option>
      <option>Django</option>
    </select>

    <label>ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³</label>
    <select id="layout">
      <option>1ã‚«ãƒ©ãƒ ï¼ˆã‚¹ãƒãƒ›ä¸­å¿ƒï¼‰</option>
      <option>2ã‚«ãƒ©ãƒ </option>
      <option>ã‚«ãƒ¼ãƒ‰å‹ãƒ‡ã‚¶ã‚¤ãƒ³</option>
    </select>

    <label>ãƒ•ã‚©ãƒ³ãƒˆ</label>
    <select id="font">
      <option>ã‚µãƒ³ã‚»ãƒªãƒ•</option>
      <option>æ˜æœä½“</option>
      <option>ä¸¸ã‚´ã‚·ãƒƒã‚¯</option>
    </select>

    <label>è‰²å‘³ãƒ»é›°å›²æ°—</label>
    <select id="color">
      <option>ãƒ–ãƒ«ãƒ¼ç³»ï¼ˆä¿¡é ¼ï¼‰</option>
      <option>ã‚ªãƒ¬ãƒ³ã‚¸ç³»ï¼ˆæ˜ã‚‹ã„ï¼‰</option>
      <option>ã‚°ãƒªãƒ¼ãƒ³ç³»ï¼ˆå®‰å¿ƒï¼‰</option>
      <option>ãƒ¢ãƒãƒˆãƒ¼ãƒ³ï¼ˆè½ã¡ç€ãï¼‰</option>
    </select>

    <label>ãƒšãƒ¼ã‚¸æ§‹æˆï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
    <select id="pages" multiple size="6">
      <option>ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</option>
      <option>å•†å“ä¸€è¦§</option>
      <option>å•†å“è©³ç´°</option>
      <option>ã‚«ãƒ¼ãƒˆ</option>
      <option>ä¼šå“¡ç™»éŒ²</option>
      <option>ãŠå•ã„åˆã‚ã›</option>
      <option>ç®¡ç†ç”»é¢</option>
    </select>

    <label>æ©Ÿèƒ½ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
    <div id="featureList">
      <label><input type="checkbox" value="ãƒ­ã‚°ã‚¤ãƒ³">ãƒ­ã‚°ã‚¤ãƒ³</label>
      <label><input type="checkbox" value="æ¤œç´¢">æ¤œç´¢</label>
      <label><input type="checkbox" value="ç™»éŒ²ãƒ»ç·¨é›†">ç™»éŒ²ãƒ»ç·¨é›†</label>
      <label><input type="checkbox" value="ã‚³ãƒ¡ãƒ³ãƒˆ">ã‚³ãƒ¡ãƒ³ãƒˆ</label>
      <label><input type="checkbox" value="é€šçŸ¥">é€šçŸ¥</label>
      <label><input type="checkbox" value="åˆ†æ">åˆ†æ</label>
    </div>

    <label>SNSé€£æºï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
    <select id="sns" multiple size="4">
      <option>Twitter</option>
      <option>Instagram</option>
      <option>LINE</option>
      <option>YouTube</option>
    </select>

    <button onclick="generateAll()">è¨­è¨ˆãƒ»è¦‹ç©ãƒ»æŒ‡ç¤ºæ›¸ã‚’ä½œæˆ</button>
  </section>

  <section class="result" id="output"></section>

  <script>
    mermaid.initialize({ startOnLoad: false });

    const tableTemplates = {
      "ãƒ­ã‚°ã‚¤ãƒ³": [{name:"id",type:"INT"},{name:"username",type:"VARCHAR"},{name:"password",type:"VARCHAR"}],
      "æ¤œç´¢": [{name:"id",type:"INT"},{name:"keyword",type:"VARCHAR"},{name:"created_at",type:"DATETIME"}],
      "ç™»éŒ²ãƒ»ç·¨é›†": [{name:"id",type:"INT"},{name:"title",type:"VARCHAR"},{name:"content",type:"TEXT"}],
      "ã‚³ãƒ¡ãƒ³ãƒˆ": [{name:"id",type:"INT"},{name:"user_id",type:"INT"},{name:"comment",type:"TEXT"}],
      "é€šçŸ¥": [{name:"id",type:"INT"},{name:"target_user",type:"INT"},{name:"message",type:"TEXT"}],
      "åˆ†æ": [{name:"id",type:"INT"},{name:"metric_name",type:"VARCHAR"},{name:"value",type:"FLOAT"}]
    };

    function generateAll() {
      const purpose = document.getElementById("purpose").value || "ãŠã¾ã‹ã›";
      const systemType = document.getElementById("systemType").value;
      const target = document.getElementById("target").value;
      const langs = Array.from(document.getElementById("langs").selectedOptions).map(o => o.value);
      const layout = document.getElementById("layout").value;
      const font = document.getElementById("font").value;
      const color = document.getElementById("color").value;
      const pages = Array.from(document.getElementById("pages").selectedOptions).map(o => o.value);
      const features = Array.from(document.querySelectorAll("#featureList input:checked")).map(f => f.value);
      const sns = Array.from(document.getElementById("sns").selectedOptions).map(o => o.value);

      // è‡ªå‹•ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
      let tables = [];
      features.forEach(f => {
        if (tableTemplates[f]) {
          tables.push({name:`${f}_tbl`, fields:tableTemplates[f]});
        }
      });
      if (tables.length === 0) tables.push({name:"main_tbl", fields:[{name:"id",type:"INT"},{name:"name",type:"VARCHAR"}]});

      // è¦‹ç©è¨ˆç®—
      const base = 150000;
      const perFeature = 30000;
      const perTable = 10000;
      const subtotal = base + features.length * perFeature + tables.length * perTable;
      const total = subtotal * 1.1;

      let html = `<h3>ğŸ“˜ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦</h3>
      <p>ç›®çš„ï¼š${purpose}<br>
      ã‚¿ã‚¤ãƒ—ï¼š${systemType}<br>
      ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼š${target}<br>
      æŠ€è¡“æ§‹æˆï¼š${langs.join(", ")}<br>
      ãƒ‡ã‚¶ã‚¤ãƒ³ï¼š${layout}ãƒ»${font}ãƒ»${color}</p>`;

      html += `<h3>ğŸ§© æ©Ÿèƒ½ä¸€è¦§</h3><table><tr><th>No</th><th>æ©Ÿèƒ½</th><th>æ¦‚è¦</th></tr>`;
      features.forEach((f,i)=>html+=`<tr><td>${i+1}</td><td>${f}</td><td>${f}æ©Ÿèƒ½ã‚’å®Ÿè£…</td></tr>`);
      html += `</table>`;

      html += `<h3>ğŸ—‚ï¸ ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ</h3>`;
      tables.forEach((t,i)=>{
        html += `<h4>${i+1}. ${t.name}</h4><table><tr><th>é …ç›®å</th><th>å‹</th></tr>`;
        t.fields.forEach(f=>html+=`<tr><td>${f.name}</td><td>${f.type}</td></tr>`);
        html += `</table>`;
      });

      html += `<h3>ğŸ’° è¦‹ç©æ˜ç´°</h3>
      <table>
      <tr><th>é …ç›®</th><th>å˜ä¾¡</th><th>æ•°é‡</th><th>å°è¨ˆ</th></tr>
      <tr><td>åŸºæœ¬è¨­è¨ˆ</td><td class="price">150,000</td><td>1</td><td class="price">150,000</td></tr>
      <tr><td>æ©Ÿèƒ½å®Ÿè£…</td><td class="price">30,000</td><td>${features.length}</td><td class="price">${features.length*30000}</td></tr>
      <tr><td>DBè¨­è¨ˆ</td><td class="price">10,000</td><td>${tables.length}</td><td class="price">${tables.length*10000}</td></tr>
      <tr><th colspan="3">åˆè¨ˆï¼ˆç¨æŠœï¼‰</th><th class="price">${subtotal.toLocaleString()}</th></tr>
      <tr><th colspan="3">ç¨è¾¼</th><th class="price">${Math.round(total).toLocaleString()} å††</th></tr>
      </table>`;

      // ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æŒ‡ç¤ºæ›¸
      const instructionText = 
`ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æŒ‡ç¤ºæ›¸ã€‘
ç›®çš„ï¼š${purpose}
ç¨®åˆ¥ï¼š${systemType}
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼š${target}
ä½¿ç”¨è¨€èªï¼š${langs.join(", ")}
ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼š${layout}
ãƒ•ã‚©ãƒ³ãƒˆï¼š${font}
è‰²å‘³ï¼š${color}
æ©Ÿèƒ½ï¼š${features.join(", ")}
ãƒšãƒ¼ã‚¸æ§‹æˆï¼š${pages.join(" â†’ ")}
SNSé€£æºï¼š${sns.join(", ")}
ãƒ†ãƒ¼ãƒ–ãƒ«æ•°ï¼š${tables.length}`;

      html += `<h3>ğŸ§¾ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆç”¨æŒ‡ç¤ºæ›¸</h3>
      <textarea id="instruction">${instructionText}</textarea>
      <button onclick="copyText()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>`;

      // SNSã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º
      const iconMap = {Twitter:"ğŸ¦", Instagram:"ğŸ“¸", LINE:"ğŸ’¬", YouTube:"â–¶ï¸"};
      html += `<h3>ğŸ”— SNSãƒªãƒ³ã‚¯</h3><div class="sns-icons">${sns.map(s=>`<span>${iconMap[s]||"ğŸŒ"} ${s}</span>`).join(" ")}</div>`;

      // ç”»é¢é·ç§»å›³
      let mermaidCode = "graph TD;\n";
      pages.forEach((p,i)=>{ if (i<pages.length-1) mermaidCode += `${p}-->${pages[i+1]}\n`; });
      html += `<h3>ğŸ§­ ç”»é¢é·ç§»å›³</h3><div class="mermaid">${mermaidCode}</div>`;

      // ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
      const previewCode = `
      <html><body style='font-family:${font}; color:#333;'>
      <h2>${systemType}</h2><p>${purpose}</p>
      <ul>${features.map(f=>`<li>${f}</li>`).join("")}</ul>
      </body></html>`;
      html += `<h3>ğŸ” ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3><iframe srcdoc="${previewCode.replace(/"/g, '&quot;')}"></iframe>`;

      html += `<button onclick="downloadPDF()">ğŸ“„ PDFå‡ºåŠ›</button>`;

      document.getElementById("output").innerHTML = html;
      mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    }

    function copyText() {
      const text = document.getElementById("instruction");
      text.select(); document.execCommand("copy");
      alert("æŒ‡ç¤ºæ›¸ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    }

    function downloadPDF() {
      const element = document.getElementById("output");
      html2pdf().set({ filename: "web_design_estimate.pdf", jsPDF: { format: "a4" } }).from(element).save();
    }
  </script>
</body>
</html>
