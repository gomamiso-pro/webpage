<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Webã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆãƒ»è¦‹ç©æ”¯æ´ãƒ„ãƒ¼ãƒ« v3</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    padding: 10px;
    background: #f5f7fa;
    max-width: 600px;
    margin: auto;
  }
  h1 { text-align: center; color: #333; font-size: 1.4em; }
  section {
    background: #fff; padding: 15px; border-radius: 10px;
    margin-top: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9em; }
  select, textarea {
    width: 100%; margin-top: 5px; margin-bottom: 10px;
    padding: 8px; border-radius: 6px; border: 1px solid #ccc; font-size: 0.9em;
  }
  button {
    width: 100%; background: #0078d4; color: white;
    border: none; padding: 10px; border-radius: 6px;
    cursor: pointer; font-size: 1em; margin-top: 10px;
  }
  button:hover { background: #005fa3; }
  .result { background: #fff; padding: 15px; border-radius: 10px; margin-top: 20px; }
  table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
  th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
  th { background: #f0f0f0; }
  .price { text-align: right; }
  .mermaid { background: #fff; border-radius: 8px; padding: 10px; margin-top: 10px; }
  #previewFrame { width: 100%; height: 250px; border: 1px solid #ccc; border-radius: 8px; margin-top: 10px; }
</style>
</head>
<body>
<h1>ğŸ“± Webè¨­è¨ˆãƒ»è¦‹ç©æ”¯æ´ãƒ„ãƒ¼ãƒ« v3</h1>

<section>
  <label>ã‚·ã‚¹ãƒ†ãƒ ç¨®åˆ¥</label>
  <select id="systemType">
    <option value="ECã‚µã‚¤ãƒˆ" data-price="200000">ECã‚µã‚¤ãƒˆï¼ˆÂ¥200,000ï¼‰</option>
    <option value="äºˆç´„ã‚·ã‚¹ãƒ†ãƒ " data-price="250000">äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆÂ¥250,000ï¼‰</option>
    <option value="ç¤¾å†…ç®¡ç†ãƒ„ãƒ¼ãƒ«" data-price="180000">ç¤¾å†…ç®¡ç†ãƒ„ãƒ¼ãƒ«ï¼ˆÂ¥180,000ï¼‰</option>
    <option value="ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ" data-price="220000">ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆï¼ˆÂ¥220,000ï¼‰</option>
  </select>

  <label>ä¸»è¦æ©Ÿèƒ½</label>
  <select id="featureSet" multiple size="5">
    <option value="ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼" data-price="30000">ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ï¼ˆÂ¥30,000ï¼‰</option>
    <option value="ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†" data-price="40000">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆÂ¥40,000ï¼‰</option>
    <option value="æ¤œç´¢ãƒ»ä¸€è¦§è¡¨ç¤º" data-price="35000">æ¤œç´¢ãƒ»ä¸€è¦§è¡¨ç¤ºï¼ˆÂ¥35,000ï¼‰</option>
    <option value="ç™»éŒ²ãƒ»ç·¨é›†" data-price="40000">ç™»éŒ²ãƒ»ç·¨é›†ï¼ˆÂ¥40,000ï¼‰</option>
    <option value="ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›" data-price="50000">ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›ï¼ˆÂ¥50,000ï¼‰</option>
    <option value="é€šçŸ¥ãƒ»ãƒ¡ãƒ¼ãƒ«é€ä¿¡" data-price="30000">é€šçŸ¥ãƒ»ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆÂ¥30,000ï¼‰</option>
    <option value="ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" data-price="45000">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆÂ¥45,000ï¼‰</option>
  </select>

  <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ¨¡</label>
  <select id="scale">
    <option value="small" data-multiplier="1.0">å°‘äººæ•°ï¼ˆã€œ100åï¼‰</option>
    <option value="medium" data-multiplier="1.3">ä¸­è¦æ¨¡ï¼ˆã€œ1,000åï¼‰</option>
    <option value="large" data-multiplier="1.6">å¤§è¦æ¨¡ï¼ˆ1,000åä»¥ä¸Šï¼‰</option>
  </select>

  <label>ç‰¹è¨˜äº‹é …</label>
  <textarea id="notes" rows="2" placeholder="è¦æœ›ã€åˆ¶ç´„ã€å¤–éƒ¨é€£æºãªã©"></textarea>

  <button onclick="generateAll()">è¨­è¨ˆæ›¸ãƒ»è¦‹ç©ã‚’ç”Ÿæˆ</button>
  <button onclick="downloadPDF()">ğŸ“„ PDFå‡ºåŠ›</button>
</section>

<section class="result" id="output"></section>

<section>
  <h3>ğŸ§ª ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
  <textarea id="codeInput" rows="5" placeholder="ã“ã“ã«HTMLã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"></textarea>
  <button onclick="previewCode()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º</button>
  <iframe id="previewFrame"></iframe>
</section>

<script>
  mermaid.initialize({ startOnLoad: false });

  function generateAll() {
    const sysSel = document.getElementById("systemType");
    const sysType = sysSel.value;
    const basePrice = parseInt(sysSel.selectedOptions[0].dataset.price);
    const features = Array.from(document.getElementById("featureSet").selectedOptions)
      .map(o => ({ name: o.value, price: parseInt(o.dataset.price) }));
    const scaleSel = document.getElementById("scale");
    const scaleText = scaleSel.options[scaleSel.selectedIndex].text;
    const mult = parseFloat(scaleSel.selectedOptions[0].dataset.multiplier);
    const notes = document.getElementById("notes").value;

    let subtotal = basePrice;
    features.forEach(f => subtotal += f.price);
    const total = Math.round(subtotal * mult);

    // æ¦‚è¦
    let summary = `<h3>ğŸ“˜ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦</h3>
    <p><strong>${sysType}</strong>ã‚’æ§‹ç¯‰ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ¨¡ï¼š${scaleText}</p>
    <ul>${features.map(f => `<li>${f.name}</li>`).join("")}</ul>`;

    // æ˜ç´°è¡¨
    let detail = `<h3>ğŸ’° è¦‹ç©æ˜ç´°</h3><table>
    <tr><th>é …ç›®</th><th class="price">é‡‘é¡ï¼ˆå††ï¼‰</th></tr>
    <tr><td>${sysType} åŸºæœ¬æ§‹ç¯‰è²»</td><td class="price">${basePrice.toLocaleString()}</td></tr>
    ${features.map(f => `<tr><td>${f.name}</td><td class="price">${f.price.toLocaleString()}</td></tr>`).join("")}
    <tr><td>è¦æ¨¡èª¿æ•´ (${scaleText})</td><td class="price">Ã—${mult}</td></tr>
    <tr><th>æ¦‚ç®—è¦‹ç©é‡‘é¡</th><th class="price">${total.toLocaleString()}</th></tr></table>`;

    // ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆï¼ˆå…·ä½“åŒ–ï¼‰
    let tableDef = `<h3>ğŸ—‚ï¸ ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ</h3>`;
    tableDef += features.map((f, i) => {
      const name = f.name.replace(/[^\w\u3000-\u9fff]/g, "").replace(/\s/g, "_").toLowerCase();
      const columns = [
        { n: "id", t: "INT", r: "PK" },
        { n: "created_at", t: "DATETIME", r: "å¿…é ˆ" },
        { n: "updated_at", t: "DATETIME", r: "å¿…é ˆ" },
        { n: name + "_name", t: "VARCHAR(100)", r: "å¿…é ˆ" },
        { n: name + "_desc", t: "TEXT", r: "ä»»æ„" },
      ];
      return `<h4>${i+1}. ${f.name}</h4>
      <table><tr><th>é …ç›®å</th><th>å‹</th><th>åˆ¶ç´„</th></tr>
      ${columns.map(c => `<tr><td>${c.n}</td><td>${c.t}</td><td>${c.r}</td></tr>`).join("")}</table>`;
    }).join("");

    // Mermaidæ§‹é€ å›³
    let diagram = `graph TD;
      A[ãƒ¦ãƒ¼ã‚¶ãƒ¼] --> B[${sysType}];
      ${features.map((f,i)=>`B --> F${i}(${f.name})`).join(" ")}`;
    let mermaidHtml = `<h3>ğŸ§­ ã‚·ã‚¹ãƒ†ãƒ æ§‹é€ å›³</h3><div class="mermaid">${diagram}</div>`;

    const memo = notes ? `<h3>ğŸ“ å‚™è€ƒ</h3><p>${notes}</p>` : "";

    document.getElementById("output").innerHTML =
      summary + detail + tableDef + mermaidHtml + memo;

    mermaid.init(undefined, document.querySelectorAll(".mermaid"));
  }

  function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ unit: "pt", format: "a4" });
    pdf.html(document.getElementById("output"), {
      callback: function (pdf) {
        pdf.save("web_system_design.pdf");
      },
      x: 20, y: 20, width: 560
    });
  }

  function previewCode() {
    const code = document.getElementById("codeInput").value;
    const frame = document.getElementById("previewFrame");
    frame.srcdoc = code;
  }
</script>
</body>
</html>
